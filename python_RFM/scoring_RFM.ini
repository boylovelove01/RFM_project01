import pandas as pd

# ğŸ“Œ à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ RFM
rfm_file_path = r"C:\Users\l3oy_\Documents\RFM_Results.xlsx"
rfm_df = pd.read_excel(rfm_file_path)

# ğŸ“Œ à¸à¸³à¸«à¸™à¸”à¸„à¸°à¹à¸™à¸™ 1-5 à¸ªà¸³à¸«à¸£à¸±à¸š R, F, M à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰ quantile
rfm_df["R_Score"] = pd.qcut(rfm_df["Recency"], q=5, labels=[5, 4, 3, 2, 1])
rfm_df["F_Score"] = pd.qcut(rfm_df["Frequency"], q=5, labels=[1, 2, 3, 4, 5])
rfm_df["M_Score"] = pd.qcut(rfm_df["Monetary"], q=5, labels=[1, 2, 3, 4, 5])

# ğŸ“Œ à¸£à¸§à¸¡à¸„à¸°à¹à¸™à¸™ RFM Score
rfm_df["RFM_Score"] = rfm_df["R_Score"].astype(int) + rfm_df["F_Score"].astype(int) + rfm_df["M_Score"].astype(int)

# ğŸ“Œ à¸à¸³à¸«à¸™à¸” Segment à¸•à¸²à¸¡ RFM Score
def assign_segment(score):
    if score >= 12:
        return "VIP"
    elif score >= 9:
        return "Loyal"
    elif score >= 6:
        return "Potential"
    else:
        return "Churn"

rfm_df["Segment"] = rfm_df["RFM_Score"].apply(assign_segment)

# ğŸ“Œ à¹à¸ªà¸”à¸‡à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
print(rfm_df.head())

# ğŸ“Œ à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸›à¹‡à¸™à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸¡à¹ˆ
rfm_segment_file = r"C:\Users\l3oy_\Documents\RFM_Segments.xlsx"
rfm_df.to_excel(rfm_segment_file, index=False)
print(f"âœ… RFM Segmentation à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¸—à¸µà¹ˆ: {rfm_segment_file}")
